<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Mi Dinero</title>

<style>
:root{
  --primary:#1e88e5;
  --danger:#e53935;
  --bg:#f2f4f8;
  --card:#ffffff;
  --text:#333;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
  color:var(--text);
}
header{
  background:var(--primary);
  color:#fff;
  padding:20px;
  text-align:center;
}
header h1{margin:0;font-size:22px}
header h2{margin:10px 0 0;font-size:28px}

.container{padding:16px}
.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
  border-radius:12px;
  border:1px solid #ccc;
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
}
button.danger{background:var(--danger)}

table{width:100%;border-collapse:collapse;margin-top:10px}
td{padding:8px;border-bottom:1px solid #ddd;font-size:14px}
td:last-child{text-align:right}

.footer{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  display:flex;
  gap:10px;
  padding:10px;
  box-shadow:0 -4px 10px rgba(0,0,0,.1);
}
.footer button{flex:1}
</style>
</head>

<body>

<header>
  <h1>ðŸ’³ Mi Dinero</h1>
  <h2 id="balance">$0.00</h2>
</header>

<div class="container">

<div class="card">
  <h3>Nuevo movimiento</h3>
  <input type="number" id="monto" placeholder="Monto">
  <select id="tipo">
    <option value="entrada">Entrada</option>
    <option value="salida">Salida</option>
  </select>
  <select id="grupo" onchange="cargarCategorias()"></select>
  <select id="categoria"></select>
  <button onclick="agregar()">Agregar</button>
</div>

<div class="card">
  <h3>Filtros</h3>
  <input type="date" id="fechaFiltro">
  <select id="categoriaFiltro"></select>
  <button onclick="aplicarFiltros()">Aplicar filtros</button>
  <button onclick="limpiarFiltros()">Limpiar</button>
</div>

<div class="card">
  <h3>Movimientos</h3>
  <table>
    <tbody id="tabla"></tbody>
  </table>
</div>

</div>

<div class="footer">
  <button class="danger" onclick="borrarTodo()">Borrar todo</button>
</div>

<script>
const categorias = {
alimentacion:["Desayuno","Comida","Cena","Snacks","CafÃ©","PanaderÃ­a","Tortillas"],
transporte:["Uber/Didi","CamiÃ³n","Estacionamiento","Casetas","Gasolina"],
hogar:["Agua GarrafÃ³n","Limpieza","Papel HigiÃ©nico","Focos","Gas LP"],
mandado:["Verduras","Frutas","Carnes","Pan","Refrescos","Mandado"],
tecnologia:["Recarga telÃ©fono","Impresiones","TelÃ©fono"],
personales:["Aseo personal","Helado","Regalo pequeÃ±o","Chivo","ManutenciÃ³n","Mis Gastos","Otros"],
trabajo:["Herramientas","Material oficina","Refacciones pequeÃ±as","NÃ³mina"],
salud:["Medicinas","Curitas"],
ninos:["Lonche escolar","Ãštiles escolares"],
mascotas:["Comida mascota","Arena"]
};

let movimientos = JSON.parse(localStorage.getItem("movimientos")||"[]");
let filtrados = [];

const grupoSel = document.getElementById("grupo");
const catSel = document.getElementById("categoria");
const catFiltro = document.getElementById("categoriaFiltro");

Object.keys(categorias).forEach(g=>{
  grupoSel.innerHTML += `<option value="${g}">${g}</option>`;
});

function cargarCategorias(){
  catSel.innerHTML="";
  categorias[grupoSel.value].forEach(c=>{
    catSel.innerHTML += `<option>${c}</option>`;
  });
}

function cargarFiltroCategorias(){
  catFiltro.innerHTML = '<option value="">Todas</option>';
  Object.values(categorias).flat().forEach(c=>{
    catFiltro.innerHTML += `<option>${c}</option>`;
  });
}

function guardar(){
  localStorage.setItem("movimientos",JSON.stringify(movimientos));
}

function agregar(){
  const monto = parseFloat(document.getElementById("monto").value);
  if(!monto || monto<=0) return;
  movimientos.push({
    monto,
    tipo:document.getElementById("tipo").value,
    categoria:catSel.value,
    fecha:new Date().toISOString().split("T")[0]
  });
  guardar();
  document.getElementById("monto").value="";
  render();
}

function aplicarFiltros(){
  const f = document.getElementById("fechaFiltro").value;
  const c = catFiltro.value;
  filtrados = movimientos.filter(m=>(!f||m.fecha===f)&&(!c||m.categoria===c));
  render(true);
}

function limpiarFiltros(){
  filtrados=[];
  document.getElementById("fechaFiltro").value="";
  catFiltro.value="";
  render();
}

function borrarTodo(){
  if(confirm("Â¿Borrar todo?")){
    movimientos=[];
    guardar();
    render();
  }
}

function render(usandoFiltros=false){
  const lista = usandoFiltros?filtrados:movimientos;
  const tabla = document.getElementById("tabla");
  tabla.innerHTML="";
  let balance=0;
  lista.forEach(m=>{
    balance += m.tipo==="entrada"?m.monto:-m.monto;
    tabla.innerHTML += `<tr>
      <td>${m.categoria}<br><small>${m.fecha}</small></td>
      <td>${m.tipo==="entrada"?"+":"-"}$${m.monto.toFixed(2)}</td>
    </tr>`;
  });
  document.getElementById("balance").textContent="$"+balance.toFixed(2);
}

cargarCategorias();
cargarFiltroCategorias();
render();
</script>

</body>
</html>
