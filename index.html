<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Gastos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#f4f6f8;padding:15px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
input,select,button{padding:8px;margin:4px}
table{width:100%;border-collapse:collapse}
td,th{border-bottom:1px solid #ddd;padding:6px}
</style>
</head>
<body>

<h2>Control de Gastos</h2>

<div class="card">
<input id="monto" placeholder="Monto">
<select id="categoria"></select>
<button onclick="agregar()">Agregar</button>
</div>

<div class="card">
<input type="month" id="mesFiltro">
<select id="categoriaFiltro"></select>
<button onclick="aplicarFiltros()">Filtrar</button>
<button onclick="limpiar()">Limpiar</button>

<table>
<thead><tr><th>Monto</th><th>Categoria</th><th>Fecha</th></tr></thead>
<tbody id="tabla"></tbody>
</table>
</div>

<script>
const categorias = ["Chivo","NÃ³mina","Mis Gastos","Comida","Transporte","Otros"];
let movimientos = JSON.parse(localStorage.getItem("movs")||"[]");
let filtrados = [];

const categoria = document.getElementById("categoria");
const categoriaFiltro = document.getElementById("categoriaFiltro");

categorias.forEach(c=>{
  categoria.innerHTML+=`<option>${c}</option>`;
  categoriaFiltro.innerHTML+=`<option value="${c}">${c}</option>`;
});
categoriaFiltro.innerHTML = '<option value="">Todas</option>' + categoriaFiltro.innerHTML;

function agregar(){
  movimientos.push({monto:monto.value,categoria:categoria.value,fecha:new Date()});
  localStorage.setItem("movs",JSON.stringify(movimientos));
  actualizar();
}

function aplicarFiltros(){
  filtrados = movimientos.filter(m=>{
    let ok=true;
    if(mesFiltro.value){
      const d=new Date(m.fecha);
      const [a,mf]=mesFiltro.value.split("-");
      ok = d.getFullYear()==a && (d.getMonth()+1)==mf;
    }
    if(ok && categoriaFiltro.value){
      ok = m.categoria===categoriaFiltro.value;
    }
    return ok;
  });
  render(filtrados);
}

function limpiar(){filtrados=[];render(movimientos)}

function actualizar(){render(movimientos)}
function render(lista){
  tabla.innerHTML="";
  lista.forEach(m=>{
    tabla.innerHTML+=`<tr><td>$${m.monto}</td><td>${m.categoria}</td><td>${new Date(m.fecha).toLocaleDateString()}</td></tr>`;
  });
}
actualizar();
</script>
</body>
</html>
